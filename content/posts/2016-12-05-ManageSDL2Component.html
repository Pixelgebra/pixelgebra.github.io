<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html" , charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixelgebra</title>
    <link rel="stylesheet" type="text/css" href="../../css/foundation.css" />
    <link rel="stylesheet" type="text/css" href="../../css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="../../css/other.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  </head>
  <body class="custom-background">
  <!-- HEAD -->
  <div class="row">
     <!-- post -->
     <div class="large-9 push-3 columns">
     
<div class="panelIdx">
<h1><a class="header" href="../../content/posts/2016-12-05-ManageSDL2Component.html">Manage SDL2 component</a></h1>
<div class="panel">
<p>As we familiar that the allocated resources must be freed once it is unnecessary. In SDL2, creating and destroying resources are managed by ourselves. In other words, we have to write two fragments of code, one for creating, one for destroying. If resources exist, it’ll require lots of effort to handle their dependence and sequence.</p>
<p>The <code>(:~&gt;)</code>, as follows, is designed for solving this issue:</p>
<pre><code>(:~&gt;) :: (MonadIO m) =&gt; (a -&gt; m b, b -&gt; m ()) -&gt; a -&gt; (b -&gt; m c) -&gt; m ()
(:~&gt;) (x,y) i f = do
   c &lt;- x i
      f c
      y c</code></pre>
<p>There are 3 parameters in this function. The first one <code>(a -&gt; m b, b -&gt; m ())</code> is to pair the creating and destroying resource functions. <code>a -&gt; m b</code> in the pair will take the second parameter, an <code>a</code>, as an input parameter to create <code>m b</code> subsystem/container in <code>MonadIO</code>. The third parameter <code>b -&gt; m c</code> is the operation that any things we want to do in <code>b</code>. For example, drawing a circle in <code>b</code>, handling key events in <code>b</code> etc. At the end, we will take <code>b -&gt; m ()</code> (first parameter of the pair) to destroy <code>b</code>.</p>
<h2 id="the-usage-of">The usage of <code>(:~&gt;)</code></h2>
<p>Next, I am going to define several pairs of the creating and destroying resource and show how it works with <code>(:~&gt;)</code>.</p>
<h3 id="init-and-quit">init and quit</h3>
<p><code>SDL.initialize</code> and <code>SDL.quit</code> are common functions that we used a lot in SDL2 library. To make it simply use. We paired them together as follows:</p>
<pre><code>sdlInit :: (MonadIO m) =&gt; ([InitFlag] -&gt; m (), () -&gt; m ())
sdlInit = (fs -&gt; SDL.initialize fs, const SDL.quit)</code></pre>
<p>Since the <code>InitVideo</code> flag is quite often used, we defined <code>sdlInitVideo</code>:</p>
<pre><code>sdlInitVideo :: (MonadIO m) =&gt; (() -&gt; m (), () -&gt; m ())
sdlInitVideo = (const $ SDL.initialize [SDL.InitVideo], const SDL.quit)</code></pre>
<h3 id="create-and-destory-window">create and destory window</h3>
<p><code>SDL.createWindow</code> and <code>SDL.destoryWindow</code> can be a pair as well. That means, we like to use <code>SDL.createWindow</code> as the first parameter of <code>(:~&gt;)</code>. However, <code>SDL.createWindow</code> itself has two parameters, yet the first parameter of <code>(:~&gt;)</code> has type of <code>a -&gt; m b</code> which is a function with single input.</p>
<p>There are two simple solutions:</p>
<ul>
<li>using customized window
<ul>
<li>We used <code>SDL.defaultWindow</code> that is default configuration of a window as one of <code>SDL.createWindow</code>’s pre-definition parameter.</li>
<li>The <code>SDL.defaultWindow</code>, however, is the second parameter of <code>SDL.createWindow</code> so we apply <code>flip</code> to swap their positions.</li>
</ul></li>
</ul>
<pre><code>    defaultWindow :: (MonadIO m) =&gt; (T.Text -&gt; m SDL.Window, SDL.Window -&gt; m ())
    defaultWindow = (flip SDL.createWindow SDL.defaultWindow, SDL.destroyWindow)</code></pre>
<ul>
<li>using uncurreied</li>
</ul>
<pre><code>    window :: (MonadIO m) =&gt; ((T.Text, SDL.WindowConfig) -&gt; m SDL.Window, SDL.Window -&gt; m ())
    window = (uncurry SDL.createWindow, SDL.destroyWindow)</code></pre>
<h3 id="more">more</h3>
<p>The other example such as, <code>SDL.getWindowSurface</code>, <code>SDL.loadBMP</code> or <code>optBmpSurface</code> can be also paired with <code>SDL.freeSurface</code>. see <a href="https://github.com/rueshyna/pixel-pen/blob/master/src/PixelPen/Container.hs">here</a> for their defitions.</p>
<h2 id="examples">Examples</h2>
<p>Now let’s see some examples of the pairs and the <code>(:~&gt;)</code>. The following examples correspond to lazyfoo’s Lession1 and Lesson2 respectively.</p>
<ul>
<li><a href="https://github.com/rueshyna/sdl2-examples/blob/master/src/Lesson01.hs">Lession1</a></li>
<li><a href="https://github.com/rueshyna/sdl2-examples/blob/master/src/Lesson02.hs">Lession2</a></li>
</ul>
<p>At the beginning of both examples, we initialize SDL as follow:</p>
<pre><code>(:~&gt;) sdlInitVideo () f</code></pre>
<p>where <code>f</code> is the computation following SDL’s initialization. Obvioursly the very first thing of <code>f</code> should be window initialization:</p>
<pre><code>(:~&gt;) sdlInitVideo ()
    $ \() -&gt; (:~&gt;) defaultWindow &quot;Lesson01&quot; g</code></pre>
<p>As same as <code>f</code>, so as <code>g</code>. Let’s see the type of <code>g</code>:</p>
<pre><code>g :: (MonadIO m) =&gt; SDL.Window -&gt; m ()</code></pre>
<p>which means we can get created windows in <code>g</code>’s body. The surface creation looks like:</p>
<pre><code>(:~&gt;) sdlInitVideo ()
   $ \() -&gt; (:~&gt;) defaultWindow &quot;Lesson01&quot;
       $ \w -&gt; (:~&gt;) surface w
            $ \s -&gt; do
                ...</code></pre>
<p>Finally, we can draw and update anything which we really want to show on the surface. Then we don’t need to worry about freeing resources. The <code>(:~&gt;)</code> should do the trick and make the whole program simple.</p>
<hr />
<p>
cct - 05 Dec 2016
<br />
<a href="../../tags/sdl2.html">sdl2</a>
</p>
<div class="panelDisqus">
<div id="disqus_thread"></div>
</div>
</div> <!-- end panel-->
</div> <!-- end panel-->

     </div>
     <!-- Sidebar -->
     <div class="large-3 pull-9 columns sidebar">
        <h1 class="text-center"><a href="../../index.html"><img src="../../img/Logo.png" /></a></h1>
        <hr />
        <ul class="side-nav">
        <li>
           <a href="../../about.html"><img src="../../img/01.png" /> About</a></li>
        <li>
           <a href="../../tags.html"><img src="../../img/02.png" /> Tags</a></li>
        <li>
           <a href="../../archive.html"><img src="../../img/03.png" /> All Posts</a></li>
        </ul>
     </div>
  </div>

  <!-- FOOTER -->
  <footer class="row">
     <hr />
     <div class="large-6 columns">
     <p>Copyright &copy; 2015 Pixelgebra. All rights reserved.</p>
     </div>
     <div class="large-6 columns text-right">
     <p>Powered by <a href="http://jaspervdj.be/hakyll">Hakyll</a>.</p>
     </div>
  </footer>
  <script src="js/vendor/modernizr.js"></script>
  <script src="js/vendor/jquery.js"></script>
  <script src="js/foundation.min.js"></script>
  <!-- JS := MathJax -->
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <!-- JS := Disqus -->
  <script type="text/javascript">
  (function() {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//pixelgebra.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
   <script id="dsq-count-scr" src="//pixelgebra.disqus.com/count.js" async></script>
   <!-- END of definition of js-->
  </body>
</html>
